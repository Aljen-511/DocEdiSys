# DocEdiSys
一个实现多人在线编辑的轻量级文档系统
A light document system that inplements multi-user edition online.



- 5.28:
> 开始任务，主要是实现框架规划


- 6.4:
> 完成两个文本对比的核心函数：
> - `get_patch`: 解析`diff`工具生成的对比格式，转为可应用的报文`patch`
> - `apply_patch_cover`:解析`patch`，将更改应用于旧版本文本

- 6.5:
> 开始规划基于grpc的程序框架

- 6.6:
> 基本完成前期规划以及设计任务, 准备开始实现
> 

- 6.15:
> 基本完成第一个版本, 但是有一些初期设想的功能还没实现
> 进入测试阶段
> 


-------------------------------------

```html
以下是系统逻辑大致说明和使用说明
```


#### 客户端启动与登录

1. 初始时, 通过运行命令启动客户端界面(服务器没有管理界面, 只有协调功能), 在此之前, **需要**根据指引(详情见`README`文档)完成**依赖以及环境的搭建**
2. 启动客户端程序之后, 在浏览器输入`localhost:10001`, 进入客户端应用界面, 此时客户端对象已创建完毕, 但没有与服务器建立逻辑连接
3. 点击右上角的头像图标, 找到**登录**选项, 在登录时, 将服务器所在的`ipv4`地址以及端口号输入, 可以自己选一个用户名. (对同一台服务器, 用户名可以重复, 真正标识用户身份的是服务器分配给用户的一个`ID`, 用户名只是为了方便后期增加修改日志记录时识别用户身份)

![init_page](img/init_page.jpg)



<img src="img/login_btn.jpg" alt="login_btn" style="zoom:50%;" />

![login_page](img/login_page.jpg)



#### 共享文档上传、编辑与撤回

4. 登录成功后, 可以点击正上方的按钮**上传文件**(系统没有做文件类型限制, 但是本系统是一个文档编辑系统, 所以最好不要上传二进制文件, 否则会在缓冲区出现乱码), 或者从**共享列表**里拉取共享文档进行编辑

<img src="img/doc_list.jpg" alt="doc_list" style="zoom:67%;" />

5. 如果是自己上传的文档, 可以在使用界面点击`编辑`按钮后, 在右下方撤销其共享, 这意味着, 其他客户**无法再对其做出修改**, 服务器不再维护该文档的一致性

6. 选择编辑文档时,  其**副本会被读取到内存中**, 所有一致性的修改都将首先被应用到内存中的副本上, 当选择撤换下当前编辑的文档时, 修改才会被**真正写回磁盘**(这是为了避免频繁的写入对性能造成的损耗, 而且客户端确实没有必要频繁写入磁盘, 客户端的失效可以通过其他正常运作的节点来继续维持文档的一致性)

7. 编辑文档后, 可以点击`上传修改`按钮, 将自己的修改上传(或者按`Ctrl+s`)

<img src="img/edit_doc.jpg" alt="edit_doc" style="zoom:67%;" />



#### 切换服务器与logout

7. 每次刷新或者关闭客户端页面时, 都会进行一次`"logout"`操作, 这个操作是善后操作(即把存储在内存的编辑文档写回磁盘), 并且将后端的`Client`对象逻辑连接断开

8. 所以, 当你想要切换服务器时, 直接刷新网页即可!



